<!DOCTYPE HTML>
<html>
	<head>
		<link href='css/bootstrap.min.css' rel='stylesheet' type='text/css'>
		<link href='css/bootstrap-responsive.min.css' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Ubuntu:400,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Vollkorn:400,700&subset=Latin' rel='stylesheet' type='text/css'>
		<link href='site.css' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="css/reset.css" type="text/css" media="screen" charset="utf-8">
  <link rel="stylesheet" href="css/icons.css" type="text/css" media="screen" charset="utf-8">
  <link rel="stylesheet" href="css/workspace.css" type="text/css" media="screen" charset="utf-8">

  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.2.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="vendor/jquery.ui.core.js" type="text/javascript" charset="utf-8"></script>
  <script src="vendor/jquery.ui.widget.js" type="text/javascript" charset="utf-8"></script>
  <script src="vendor/jquery.ui.position.js" type="text/javascript" charset="utf-8"></script>
  <script src="vendor/jquery.ui.autocomplete.js" type="text/javascript" charset="utf-8"></script>
  <script src="vendor/underscore-1.1.5.js" type="text/javascript" charset="utf-8"></script>
  <script src="vendor/backbone-0.5.0.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/visualsearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/views/search_box.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/views/search_facet.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/views/search_input.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/models/search_facets.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/models/search_query.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/utils/backbone_extensions.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/utils/hotkeys.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/utils/jquery_extensions.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/utils/search_parser.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/utils/inflector.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/templates/templates.js" type="text/javascript" charset="utf-8"></script>

	</head>

	<body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="./index.html">PixelDB</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active">
                <a href="./home.html">Recherche</a>
              </li>
              <li class="">
                <a href="./doc.html">Documentation</a>
              </li>
              <li class="">
                <a href="./about.html">À propos</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>



	<div id="subhead" class="jumbotron"> 
		<h1>“Who controls the past</br>controls the future.”</h1>

	<div class="container" id="VS">
			<div id="search_box_container"></div>
	    	<div id="search_query">&nbsp;</div>
	</div>

	</div>


<div class="alert" id="tooMuchResults">
  <button type="button" class="close" data-dismiss="alert">×</button>
  <strong>Attention!</strong> La recherche a donné plus de 25 résultats. Affinez votre recherche.
</div>

			<div id="table_container">
			</div>


    <script type="text/javascript" charset="utf-8">
      $(document).ready(function() {

      	$("#tooMuchResults").hide();

        window.visualSearch = VS.init({
          container  : $('#search_box_container'),
          query      : '',
          //ec2-50-112-64-221.us-west-2.compute.amazonaws.com
          unquotable : [
            'text',
            'account',
            'filter',
            'access'
          ],
          callbacks  : {
            search : function(query, searchCollection) {
              var $query = $('#search_query');
              $query.stop().animate({opacity : 1}, {duration: 300, queue: false});
              $query.html('<span class="raquo">&raquo;</span> Vous recherchez pour: <b>' + searchCollection.serialize() + '</b>');

console.log(searchCollection.serialize());

$("#tooMuchResults").hide(1000);

$.ajax(
{
    type: "POST", 
    url: 'http://ec2-50-112-64-221.us-west-2.compute.amazonaws.com:8080/title?title=' + searchCollection.serialize(),
    dataType: 'json',
    data: {NRC:10265},
    error: function(e, a) {console.log("ERROR"); console.log(e);} ,
    success: function(e) {
console.log(e);

if(e.length >= 25) {
	$("#tooMuchResults").show(1000);
}

$("#table_container").empty();

$("#table_container").append('<table class="table table-hover" id="courses_table"><thead><tr><th>NRC</th><th>Numéro du cours</th><th>Titre du cours</th><th>Professeur</th><th>Session</th><th>Actions</th></tr></thead><tbody>');

    	$.each(e, function() {

var row = '<tr><td>' + this.nrc + '</td><td>' + this.number + '</td><td>' + this.title + '</td><td>' + this.teachers + '</td><td>N/A</td><td><a class="btn btn-small" href="#"><i class="icon-signal"></i></a></td></tr>';

$("#courses_table").append(row);


    	});

    	$("#courses_table").append("</tbody></table>");

    }
});


              clearTimeout(window.queryHideDelay);
              window.queryHideDelay = setTimeout(function() {
                $query.animate({
                  opacity : 0
                }, {
                  duration: 1000,
                  queue: false
                });
              }, 2000);
            },
            valueMatches : function(category, searchTerm, callback) {
              switch (category) {
              case 'NRC':
                  callback([
                    // TODO Callback
                  ]);
                  break;
                case 'Année':
                  callback([
                    "2009", "2010", "2011", "2012"
                  ])
                  break;
                case 'Session':
                  callback([
                    { value: '01',  label: 'Hiver' },
                    { value: '05',  label: 'Été' },
                    { value: '09',  label: 'Automne' }
                  ]);
                  break
                case 'Programme':
                  callback([
                    "GIF", "GEL", "GLO", "GMN"
                  ], {preserveOrder: true});
                  break;
              }
            },
            facetMatches : function(callback) {
              callback([
                'NRC', 'Titre', 'Numéro', 'Professeur','Année', 'Session', 'Programme'
              ]);
            }
          }
        });
      });
    </script>

	<a href="https://github.com/slvnperron/Pixel"><img style="position: absolute; top: 0; right: 0; border: 0; z-index: 1000000" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>

	</body>

</html>